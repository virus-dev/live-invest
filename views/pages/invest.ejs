<!DOCTYPE html>
<html lang="en">

<head>
    <% include ../partials/head %>
</head>

<script>
    var login_key = [
      "virus00000",
      "virus83683",
      "virus93670",
      "virus12558",
      "virus14830",
      "virus12992",
      "virus40552",
      "virus21158",
      "virus54791",
      "virus60193",
      "virus64032",
      "virus42756",
      "virus50256",
      "virus58206",
      "virus51854",
      "virus34957",
      "virus07323",
      "virus06432",
      "virus91230",
      "virus22813",
      "virus37315",
      "virus51103",
      "virus94064",
      "virus13833",
      "virus74268",
      "virus32773",
      "virus77025",
      "virus36867",
      "virus79309",
      "virus01333",
      "virus62673",
      "virus81019",
      "virus74911",
      "virus66974",
      "virus73196",
      "virus84759",
      "virus14591",
      "virus66806",
      "virus39044",
      "virus78631",
      "virus56420",
      "virus29004",
      "virus94140",
      "virus61430",
      "virus37959",
      "virus08795",
      "virus09910",
      "virus28424",
      "virus50239",
      "virus56933",
      "virus88798",
      "virus78894",
      "virus43364",
      "virus00299",
      "virus92637",
      "virus11203",
      "virus24929",
      "virus95283",
      "virus57164",
      "virus99977",
      "virus63404",
      "virus39310",
      "virus89892",
      "virus59006",
      "virus92764",
      "virus41116",
      "virus27582",
      "virus44885",
      "virus34739",
      "virus85969",
      "virus70586",
      "virus71873",
      "virus49199",
      "virus68014",
      "virus95289",
      "virus98055",
      "virus69236",
      "virus72184",
      "virus60297",
      "virus21433",
      "virus29780",
      "virus64194",
      "virus26771",
      "virus41777",
      "virus57212",
      "virus89450",
      "virus61451",
      "virus35304",
      "virus84681",
      "virus15044",
      "virus16134",
      "virus23890",
      "virus45019",
      "virus96595",
      "virus84554",
      "virus60681",
      "virus50388",
      "virus43667",
      "virus49156",
      "virus94718",
      "virus12740",
      "virus39556",
      "virus19301",
      "virus84913",
      "virus80671",
      "virus51002",
      "virus66211",
      "virus47569",
      "virus39932",
      "virus43190",
      "virus68407",
      "virus53084",
      "virus52268",
      "virus85302",
      "virus78069",
      "virus75658",
      "virus69919",
      "virus76903",
      "virus65576",
      "virus94411",
      "virus59906",
      "virus06181",
      "virus02512",
      "virus04085",
      "virus05060",
      "virus32521",
      "virus63479",
      "virus01234",
      "virus79610",
      "virus58590",
      "virus28045",
      "virus62915",
      "virus23757",
      "virus05561",
      "virus50206",
      "virus30460",
      "virus64831",
      "virus18235",
      "virus76619",
      "virus66341",
      "virus88365",
      "virus24880",
      "virus90160",
      "virus16204",
      "virus89186",
      "virus78518",
      "virus61444",
      "virus05179",
      "virus91962",
      "virus38351",
      "virus23422",
      "virus81142",
      "virus32943",
      "virus08549",
      "virus39777",
      "virus46980",
      "virus20243",
      "virus62125",
      "virus26483",
      "virus37870",
      "virus95172",
      "virus05003",
      "virus46755",
      "virus34381",
      "virus39252",
      "virus38935",
      "virus62276",
      "virus32731",
      "virus83035",
      "virus67455",
      "virus85310",
      "virus74265",
      "virus42298",
      "virus57015",
      "virus15455",
      "virus75560",
      "virus26967",
      "virus98720",
      "virus09922",
      "virus64596",
      "virus76819",
      "virus45492",
      "virus94139",
      "virus05769",
      "virus88488",
      "virus15381",
      "virus64512",
      "virus08469",
      "virus62131",
      "virus33360",
      "virus33540",
      "virus87783",
      "virus55715",
      "virus57468",
      "virus73659",
      "virus67015",
      "virus17376",
      "virus49679",
      "virus38777",
      "virus24144",
      "virus36940"
        /*
        "virus00001",
        "virus00002",
        ...
        위의 형식으로 login_key 를 추가해주세요.
        */
    ]

    var login = null;
    var break_value = 0;

    $(document).ready(function() {
        $("#modal-open").click();

        $(".login-need").hide();

        //메모 쓰기 요청을 처리하는 부분입니다.
        var login = function(contents) {
            var postdata = {
                'user_name': $("#user_name").val(),
                'user_phone': $("#user_phone").val()
            };
        };

        var write = function(contents) {
            var postdata = {
                'user_name': $("#user_name").val(),
                'user_phone': $("#user_phone").val(),
                'user_invest1': $("#user_invest1").val(),
                'user_invest2': $("#user_invest2").val(),
                'user_invest3': $("#user_invest3").val(),
                'user_invest4': $("#user_invest4").val(),
                'user_invest5': $("#user_invest5").val(),
                'user_invest6': $("#user_invest6").val(),
                'user_invest7': $("#user_invest7").val(),
                'user_invest8': $("#user_invest8").val()
            };

            $.post('/invest', postdata, function() {
                // load();
            });
        };

        //쓰기 버튼을 눌렀을 때 쓰기 요청을 발생시키기 위한 부분입니다.
        $("#login_button").click(function(evt) {
            if (login_key.indexOf($("#user_phone").val()) < 0) {
                alert("등록되지 않은 key 입니다!");
                alert("운영자에게 받은 key 값을 정확히 입력하세요. (ex. virus00000)");
            } else {
                $.get('/load', function(data) {
                    $(data).each(function(i) {
                        if (this.user_phone == $("#user_phone").val()) {
                            break_value = 1;
                            alert("이미 투표한 사용자입니다");
                            alert("중복 투표는 불가합니다");
                            location.reload();
                        }
                    });
                    if (break_value == 0) {
                        alert("로그인 성공!");
                        $(".login-need").show();
                        $(".login").prop('disabled', true);

                        $("#invest_button").click(function(evt) {
                            var invest1 = $("#user_invest1").val() * 1;
                            var invest2 = $("#user_invest2").val() * 1;
                            var invest3 = $("#user_invest3").val() * 1;
                            var invest4 = $("#user_invest4").val() * 1;
                            var invest5 = $("#user_invest5").val() * 1;
                            var invest6 = $("#user_invest6").val() * 1;
                            var invest7 = $("#user_invest7").val() * 1;
                            var invest8 = $("#user_invest8").val() * 1;

                            var user_totalinvest = invest1 + invest2 + invest3 + invest4 + invest5 + invest6 + invest7 + invest8;
                            if (user_totalinvest != 1000) {
                                alert("에러! 총 투자 금액은 정확히 1000 이어야 합니다");
                                alert("현재 투자 금액은 " + user_totalinvest + " 입니다");
                            } else {
                                if (invest1 < 0 || invest2 < 0 || invest3 < 0 || invest4 < 0 || invest5 < 0 || invest6 < 0 || invest7 < 0 || invest8 < 0) {
                                    alert("에러! 음수 값은 입력할 수 없습니다.");
                                } else {
                                    write();
                                    alert("투표 완료! " + $("#user_name").val() + " 님 감사합니다");
                                    location.reload();
                                }
                            }
                        });
                    }
                });
            }
        });
    });
</script>

<body style="background-color:#0e1f45">
    <header>
        <div class="header-content">
            <div id='main' class="header-content-inner">
                <table id="table-login">
                    <tr class="tr-mainimage">
                        <td colspan="2"><img src="../images/VIRUS_logo_row_white_none.png"></td>
                    </tr>
                    <tr>
                        <th width="40px"><img src="../images/img_name.png"></th>
                        <td width="200px"><input id='user_name' class='user_name login' type='text' placeholder='이름을 입력하세요' /></td>
                    </tr>
                    <tr style="height: 5px">
                    </tr>
                    <tr>
                        <th><img src="../images/img_phone.png"></th>
                        <td><input id='user_phone' class='user_phone login' type='text' placeholder='받은 key 값을 입력하세요' /></td>
                    </tr>
                    <tr style="height: 15px">
                    </tr>
                    <tr>
                        <td colspan="2">
                            <input id='login_button' class="" type='button' value='로그인' style="background-color: #00a6b5" />
                        </td>
                    </tr>
                </table>
                 <table id="table-invest" class="login-need">
                    <tr class="tr-invest">
                        <th width="160px">팀 1: #</th>
                        <td width="80px"><input id='user_invest1' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 2: ##</th>
                        <td><input id='user_invest2' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 3: ###</th>
                        <td><input id='user_invest3' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 4: ####</th>
                        <td><input id='user_invest4' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 5: #####</th>
                        <td><input id='user_invest5' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 6: ######</th>
                        <td><input id='user_invest6' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 7: #######</th>
                        <td><input id='user_invest7' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr class="tr-invest">
                        <th>팀 8: ########</th>
                        <td><input id='user_invest8' class='user_invest' type='text' placeholder='투자금(만원)' /></td>
                    </tr>
                    <tr style="height: 15px">
                    </tr>
                    <tr class="login-need">
                        <td colspan="2">
                            <input id='invest_button' class="" type='button' value='투자' style="background-color: #a7cb08" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </header>

    <!-- Button trigger modal -->
    <button id="modal-open" type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" style="visibility: hidden">
    </button>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">실시간 모의 투자 시스템</h4>
                </div>
                <div class="modal-body">
                    <p>1. 이름과 디렉터로부터 받은 key 값을 <b>정확히</b> 입력 후, 로그인 해주세요.</p>
                    <p>정확히 입력하였는데도 "등록되지 않은 사용자입니다!" 라는 메세지가 나오면 디렉터에게 알려주세요!</p>
                    <p>2. 로그인 완료 시 개인 당 <b>1000만원</b>의 투자금이 주어집니다.</p>
                    <p>1000만원을 8팀에 <b>모두</b> 분배하신 후, 투자 버튼을 눌러주세요.</p>
                    <p>투자금의 단위는 <b>만원</b>입니다. 즉, 투자금의 총합이 <b>정확히 1000</b>이 되어야 합니다.</p>
                    <p>3. 실시간 결과는 <a href="/result">다음의 링크</a>에서 확인하실 수 있습니다.</p>
                    <p>4. 기타 문제 발생 시 디렉터에게 알려주세요!</p>
                    <hr/>
                    <p>본 프로그램은 청년 창업 문화 확산을 위해 <a href="https://www.facebook.com/pg/virusnetwork.official/">바이러스 네트워크</a>가 제작하였습니다.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">확인</button>
                </div>
            </div>
        </div>
    </div>

    <% include ../partials/body_script %>
</body>

</html>
